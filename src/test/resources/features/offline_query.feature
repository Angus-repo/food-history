# language: zh-TW
功能: 離線查詢功能
  作為一個使用者
  我想要在離線狀態下也能查詢食物資料
  以便我在沒有網路時也能使用這個應用程式

  背景:
    假如 我已登入系統
    而且 資料庫中有以下食物:
      | id  | name         | carbGrams | quantity | unit | notes          | imagePath    |
      | 101 | 麥當勞大麥克 | 45.0      | 1.0      | 個   | 經典漢堡       | burger.jpg   |
      | 102 | 肯德基炸雞   | 30.0      | 2.0      | 塊   | 原味           | chicken.jpg  |
      | 103 | 白米飯       | 28.0      | 100.0    | 公克 | 台灣蓬萊米     |              |
      | 104 | 麥當勞薯條   | 35.0      | 1.0      | 份   | 中份           | fries.jpg    |
      | 105 | 可口可樂     | 39.0      | 330.0    | 毫升 | 冰的           |              |

  場景: 取得所有食物資料用於離線快取
    當 我請求離線快取資料 API
    那麼 API 應該返回成功狀態
    而且 回應應該包含所有食物資料
    而且 回應應該包含 5 筆食物
    而且 每筆食物資料應該包含完整欄位

  場景: 離線快取資料應包含圖片 URL
    當 我請求離線快取資料 API
    那麼 API 應該返回成功狀態
    而且 有圖片的食物應該包含圖片 URL
    而且 食物 "麥當勞大麥克" 應該有圖片路徑 "burger.jpg"
    而且 食物 "白米飯" 應該沒有圖片路徑

  場景: 離線快取資料應包含快取版本號
    當 我請求離線快取資料 API
    那麼 API 應該返回成功狀態
    而且 回應應該包含快取版本號
    而且 回應應該包含快取時間戳記

  場景: 取得圖片列表用於預載
    當 我請求圖片預載列表 API
    那麼 API 應該返回成功狀態
    而且 回應應該包含所有圖片 URL
    而且 圖片列表應該有 3 個項目

  場景: 檢查快取版本是否需要更新
    假設 本地快取版本為 "v1"
    當 我請求快取版本檢查 API
    那麼 API 應該返回成功狀態
    而且 回應應該包含當前伺服器版本號

  場景: 離線狀態下使用快取資料搜尋 - 完全符合
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "麥當勞"
    那麼 本地搜尋結果應該包含 2 筆
    而且 本地搜尋結果應該包含 "麥當勞大麥克"
    而且 本地搜尋結果應該包含 "麥當勞薯條"

  場景: 離線狀態下使用快取資料搜尋 - 部分符合
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "雞"
    那麼 本地搜尋結果應該包含 1 筆
    而且 本地搜尋結果應該包含 "肯德基炸雞"

  場景: 離線狀態下使用快取資料搜尋 - 搜尋備註欄位
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "原味"
    那麼 本地搜尋結果應該包含 1 筆
    而且 本地搜尋結果應該包含 "肯德基炸雞"

  場景: 離線狀態下使用快取資料搜尋 - 無結果
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "披薩"
    那麼 本地搜尋結果應該包含 0 筆

  場景: 離線狀態下搜尋不區分大小寫
    假設 資料庫中有以下食物:
      | id  | name      | carbGrams | quantity | unit |
      | 201 | Apple Pie | 35.0      | 1.0      | 片   |
    而且 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "apple"
    那麼 本地搜尋結果應該包含 1 筆

  場景: 網路恢復後自動更新快取
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 網路連線恢復為上線狀態
    那麼 系統應該在背景檢查快取版本
    而且 如果有新版本應該自動更新快取

  場景: 離線快取應包含分頁資訊
    當 我請求離線快取資料 API
    那麼 API 應該返回成功狀態
    而且 回應應該包含總筆數為 5
    而且 回應應該標示這是完整的資料集

  場景: Service Worker 註冊成功
    當 我訪問食物列表頁面
    那麼 Service Worker 應該被成功註冊
    而且 Service Worker 應該進入 active 狀態

  場景: 離線時顯示離線指示器
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我訪問食物列表頁面
    那麼 頁面應該顯示離線指示器
    而且 搜尋功能應該使用本地快取

  場景: 離線搜尋結果顯示與線上一致
    假設 我已經預載所有食物資料到本地快取
    而且 網路連線為離線狀態
    當 我在本地快取中搜尋關鍵字 "可樂"
    那麼 本地搜尋結果應該包含 1 筆
    而且 搜尋結果應該顯示食物卡片
    而且 食物卡片應該顯示名稱 "可口可樂"
    而且 食物卡片應該顯示碳水化合物 39.0

  場景: 預載進度顯示
    當 系統開始預載所有食物資料
    那麼 頁面應該顯示預載進度
    而且 預載完成後應該顯示完成訊息
